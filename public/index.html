<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=5.0,user-scalable=yes">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title>
    <%= htmlWebpackPlugin.options.title %>
  </title>
  <script>
    // CRITICAL: Suppress ResizeObserver and WebSocket errors BEFORE webpack-dev-server loads
    // This must run in <head> before any other scripts
    (function () {
      'use strict';
      const resizeObserverRegex = /ResizeObserver/i;
      const websocketErrorRegex = /WebSocket connection.*failed|bootstrap.*WebSocket|ws:\/\/.*failed/i;

      // Override Error constructor immediately
      const OriginalError = window.Error;
      window.Error = function (...args) {
        const error = new OriginalError(...args);
        const errorText = (error.message || "") + (error.stack || "");
        if (resizeObserverRegex.test(errorText) || websocketErrorRegex.test(errorText)) {
          error.message = "";
          error.stack = "";
          error.name = "";
        }
        return error;
      };
      window.Error.prototype = OriginalError.prototype;
      Object.setPrototypeOf(window.Error, OriginalError);

      // Override console.error immediately
      const originalConsoleError = console.error;
      console.error = function (...args) {
        const hasResizeObserverOrWebSocket = args.some(arg => {
          const text = String(arg || "");
          return resizeObserverRegex.test(text) || websocketErrorRegex.test(text);
        });
        if (!hasResizeObserverOrWebSocket) {
          originalConsoleError.apply(console, args);
        }
      };

      // Override window.onerror immediately
      window.onerror = function (message, source, lineno, colno, error) {
        const allText = [
          String(message || ""),
          String(error?.message || ""),
          String(error?.stack || ""),
          String(error?.name || "")
        ].join(" ");
        if (resizeObserverRegex.test(allText) || websocketErrorRegex.test(allText)) {
          return true; // Suppress completely
        }
        return false;
      };

      // Override addEventListener for error events
      const originalAddEventListener = window.addEventListener;
      window.addEventListener = function (type, listener, options) {
        if (type === 'error') {
          const wrappedListener = function (event) {
            const errorText = [
              event?.message || "",
              event?.error?.message || "",
              event?.error?.stack || ""
            ].join(" ");
            if (resizeObserverRegex.test(errorText) || websocketErrorRegex.test(errorText)) {
              event.preventDefault();
              event.stopPropagation();
              event.stopImmediatePropagation();
              return false;
            }
            return listener.call(this, event);
          };
          return originalAddEventListener.call(window, type, wrappedListener, options);
        }
        return originalAddEventListener.call(window, type, listener, options);
      };
    })();
  </script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
</head>

<body>
  <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
        Please enable it to continue.</strong>
  </noscript>
  <div id="app"></div>
  <!-- built files will be auto injected -->
  <script>
    // Suppress ResizeObserver and WebSocket errors before webpack-dev-server loads
    (function () {
      const resizeObserverRegex = /ResizeObserver/i;
      const websocketErrorRegex = /WebSocket connection.*failed|bootstrap.*WebSocket|ws:\/\/.*failed/i;

      // Override Error constructor early
      const OriginalError = window.Error;
      window.Error = function (...args) {
        const error = new OriginalError(...args);
        if (resizeObserverRegex.test(error.message || "") || websocketErrorRegex.test(error.message || "")) {
          // Make error silent
          error.message = "";
          error.stack = "";
        }
        return error;
      };
      window.Error.prototype = OriginalError.prototype;

      // Override console.error early
      const originalConsoleError = console.error;
      console.error = function (...args) {
        if (args.some(arg => {
          const text = String(arg || "");
          return resizeObserverRegex.test(text) || websocketErrorRegex.test(text);
        })) {
          return;
        }
        originalConsoleError.apply(console, args);
      };

      // Override window.onerror early
      window.onerror = function (message, source, lineno, colno, error) {
        const allText = [message, error?.message, error?.stack].join(" ");
        if (resizeObserverRegex.test(allText) || websocketErrorRegex.test(allText)) {
          return true; // Suppress
        }
        return false;
      };
    })();
  </script>
</body>

</html>